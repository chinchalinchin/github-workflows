name: Scan

on: 
  workflow_call:

jobs:        
  checkov:
    name: terraform checkov scan
    runs-on: debian
    steps:    
      - name: Dependencies
        run: |
          sudo apt-get update -y
          sudo apt-get install -y python3-dev python3-pip build-essential
          pip3 install checkov
      - name: Clone
        uses: actions/checkout@v2
      - name: Scan
        run: |
          checkov -d .

  tfsec:
    name: terraform security scan
    runs-on: debian
    steps:
      - name: Clone repo
        uses: actions/checkout@v2
      - name: Setup tfsec
        run: curl -s https://raw.githubusercontent.com/aquasecurity/tfsec/master/scripts/install_linux.sh | bash
      - name: Run Terraform Security Scan
        run: tfsec .